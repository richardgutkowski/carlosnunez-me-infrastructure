FROM jenkinsci/jenkins
MAINTAINER Carlos Nunez <dev@carlosnunez.me>

COPY files/jenkins/config.xml /var/jenkins_home/config.xml
USER root
RUN chown root:root /var/jenkins_home/config.xml
RUN chmod 400 /var/jenkins_home/config.xml
USER jenkins
COPY files/jenkins/create_admin_user.groovy /usr/share/jenkins/ref/init.groovy.d/create_admin_user.groovy
COPY files/jenkins/jobs/deploy-infrastructure-seed-job.xml /usr/share/jenkins/ref/jobs/deploy-infrastructure-carlosnunez.me/config.xml

RUN install-plugins.sh workflow-aggregator job-dsl git
