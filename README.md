What is this?
=============

This will provision Carlos's working environment from scratch on AWS. It is also
meant to be an example of how to deploy infrastructure-as-code from start to
finish on a cloud platform.

There will be other branches of this code for other cloud and noncloud providers.
Check them out!

What's required?
================

* An AWS account key and secret. You can get that by signing up on aws.com, downloading the awscli (`pip install awscli`) and running `aws configure`.
* Docker CE >= v17.03
* docker-compose
* Terraform tfvars stored in AWS S3. (You can change this by adjusting the `Jenkinsfile`)
* Terraform tfstate stored in AWS S3. (You can change this by adjusting the `Jenkinsfile`)

NOTE: Terraform will use the AWS region, access and secret keys defined by the
environment variables AWS_REGION, AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
respectively. `rake` will let you know if they're missing. :)

How do I run this?
==================

Run `./deploy ${environment}`. This will create a local Jenkins CI that
will deploy your infrastructure through the pipeline defined by
`Jenkinsfile`.

NOTE
----

The first run of this pipeline might take a while, as this repository builds
a custom Jenkins image and a custom Alpine image for the container running this
pipeline. It can also take a while for the deploy job to source `terraform` and
all of the gems needed to run `rake`.

Subsequent runs should complete much more quickly.

Considerations
===============

1. A logging container hasn't been created yet. I highly recommend creating one
and piping all of the output generated by pipeline runner into a logging service
like Datadog or your local disk.

2. Docker for Windows has trouble mounting volumes when done within WSL. If you
want to bind-mount a volume, use `/c/Users/your_windows_username/etc.`.

3. If you're running Docker for Windows or Docker for Mac and run `./deploy` enough
times in one session, you might run into an issue where Docker is unable to
create the reverse proxy to the container from your localhost. If this happens, 
restart your Docker engine.

Damn, son; why do you have so many commits?!
=============================================

Either...
1. I don't know how to code, or
2. I commit on every save. Want to do the same? Check out my [.vimrc](https://github.com/carlosonunez/setup.git)
